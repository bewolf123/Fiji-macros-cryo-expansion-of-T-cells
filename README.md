# Fiji-macros-cryo-expansion-of-T-cells
Fiji/ImageJ macros to analyze cryo-expanded T cell image-stacks in 3D
Summary

The Fiji macros were designed to analyse immune synapses features and lytic granule shape and fluorescent intensity. All Fiji macros were written to work with .lif files obtained with a widefield Leica DMi8 thunder microscope. The macros were made to work on the denoised images (Lng_LVCC or Lng_SVCC). When indicated, it can be necessary to use a first macros to facilitate the use of another. All tables are automatically saved in newly created folders where the original image file is located. The file and folder names must remain as registered to not introduce macros’ errors. 
 
Macros:
•	Cryo-ExM_synapse_segmentation: This macro was designed to automatically segment the cell edge based on the Actin and Dapi signal. It returns a .zip folder containing the different ROIs of the T cell edges. These .zip folders are renamed and automatically saved in a “Segmented” folder. These ROIs will be subsequently used for other cell analysis. The ROIs obtained with this macro can be manually corrected when necessary to ensure single cell segmentation.
•	Cryo-ExM_IS_morphology_intensity: This macro was designed to acquire T cell dimension measurements and fluorescence intensity measurement. It first requires the T cell ROIs segmentation obtained with the “Cryo-ExM_synapse_segmentation” macro to get individual cells within each image. It allows to get the z position of the first actin signal in contact with the coverslip (Z0), the position of the synaptic dome (Z1) and the position of the top of the cell (Z2) using the orthogonal slicer. Then, the fluorescent signal of the protein of interest is measured for the entire cell (Z0 to Z2) and for the synapse region (Z0 to Z1). Each time the user is asked to choose a corresponding ROI for background measurements. The data are saved in two separated tables, “Synaptic_dimentions” and “Total_Intensity_Results”, with the cell ID. 
•	Cryo-ExM_Concentric_bins: This macro was made to assess the xy distribution of the protein of interest within the synaptic area. It first requires the T cell ROIs segmentation obtained with the “Cryo-ExM_synapse_segmentation” macro to get individual cells within each image. It allows to get the z position of the first actin signal in contact with the coverslip (Z0) and the position of the synaptic dome (Z1) using the orthogonal slicer. The Synaptic region (Z0 to Z1) is z projected, and the segmented T cell ROI is used to draw 5 concentric bins from the cell edge to the cell center. The fluorescence intensity of the protein of interest is then measured within each bin. Each time the user is asked to choose a corresponding ROI for background measurements. The data are saved in a “Concentric_total_intensity” table with the cell ID. 
•	Cryo-ExM_LyticGranules_segmentation: This macro was designed to perform 3D segmentation of PERFORIN and GRANZYMB lytic entity using pre-trained Labkit models. It allows to get the 3D shape measurement, there z position within the T cell and their individual fluorescence intensity. It first requires the T cell ROIs segmentation obtained with the “Cryo-ExM_synapse_segmentation” macro to get individual cells within each image. The Perforin and GranzymeB Labkit models must be stored within the same folder. Note that the file names must match the protein names that will be defined by the user (e.g. Perf).  
The macro asks to identify the z position of the first actin signal in contact with the coverslip (Z0), the position of the synaptic dome (Z1) and the position of the top of the cell (Z2) using the orthogonal slicer. The T cell dimensions are stored. Subsequently, it allows the user to measure the total fluorescence intensity of perforin and granzymeB within the entire cell, as well as the corresponding background. The data are stored in “Total_Intensity_Results” and “Background_Intensity_Results” tables, respectively. For lytic entities’ 3D segmentation, the macro calls the Labkit plugin and the corresponding pre-trained models. It allows for 3D segmentation of Perforin and GranzymeB lytic entities and produces probability map images that will be saved in a specific folder. The user is asked to manually threshold the probability maps, allowing to create an object map containing 3D objects that will be loaded into the 3D manager. Shape measurement and fluorescent intensity measurements is performed using the 3D manager. The polarization index (z coordinate of center of mass) of each individual granule is calculated accordingly to the synapse plan (Z0) and the synaptic dome (Z1). 
Finally, Perforin and GranzymeB 3D colocalization is evaluated using the 3D MultiColoc plugin. The data are saved in separated tables.

•	Cryo-ExM_get_vesicules_cropAndResize: This macro was inspired by the CropAndResize plugin. It allows to create several ROIs on the selected stack images to isolate lytic granules based on there LAMP1, PERFORIN and GRANZYMEB signal. The user is asked to draw squared ROIs that will be used to duplicate and isolate individual LAMP1 vesicles. The user chose the lower and upper z-stack the reduce the stack size. The selected ROIs will be resized following the same process than the "crop and resize" macro of the centriole lab. The pictures are automatically saved as .tif images in the crop & and resize folder.

•	Cryo-ExM_pickVesiculesDimention:  This macro is using .tif images. It was designed to measure the diameter of LAMP1 positive vesicles and count the number of PERFORIN and GRANZYMEB foci within the vesicles. It first requires the crop and resized .tif images obtained with the “Cryo-ExM_get_vesicules_cropAndResize” macro. The user is asked to draw a line on the LAMP1 channel. This is generating a plot profile where the user must choose the two picks corresponding to the vesicle’s edges. A second plot profile appears with a line corresponding to 50% of the fluorescence for the two picks to measure the correct vesicle diameter. For, each vesicle, the user has to indicate the number of lytic entities within the vesicle for both PERFORIN and GRANZYMEB. The results are save in one “Prot_Measurement” table.

